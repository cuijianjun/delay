<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>

        body {
            padding: 0;
            margin: 0;
        }

        .box {
            width: 200px;
            height: 200px;
            background-color: pink;


            position: absolute;
            left: 20px;
        }
    </style>
</head>
<body>
    <!-- 只需要使用 javascript 动态的修改 css 的值 -->
    <!-- 不是所有的 css 都可以实现动画的切换 -->
    <!-- 一般是那些 css 属性值为数字类的 -->
    <div class="box"></div>
    
    <script src="./tween.js"></script>
    <script>
        // 封装一个动画库

        // animate(哪个元素, 执行哪些动画, 多长时间, 动画类型, 回调函数)

        function animate(dom, props, duration, easing, callback) {

            // 1. 分析哪些属性有执行动画的必要
            // a) 获取元素原始的值

            var styles = window.getComputedStyle(dom, null);

            // b) 变化后的值与原始值进行对比

            var begin, change;
            // changes 用来存储所有属性变化的值
            // begins 用来存储所有属性原始的值
            var changes = {}, begins = {};
            for(var prop in props) {
                begin = parseInt(styles[prop]);

                change = props[prop] - begin;

                if(change != 0) {
                    begins[prop] = begin;
                    changes[prop] = change;
                }
            }

            // console.log(begins);
            // console.log(changes);

            // 2. 通过遍历对所有需要执行动画的元素设置 css

            // 3. 执行动画过程中需要检测动画的类型

            // 4. 重复调用 requestAnimationFrame

            var d = Math.ceil(duration / 17);
            var t = 0;
            var easing = easing.split('.');
            var effect = Tween[easing[0]][easing[1]];

            function step() {
                t++;
                for(var key in changes) {

                    var val = effect(t, begins[key], changes[key], d);

                    dom.style[key] = val + 'px';
                }

                if(t < d) {
                    requestAnimationFrame(step);
                } else {
                    callback();
                }
            }

            step();
        }

        var box = document.querySelector('.box');

        box.addEventListener('click', function () {

            // 执行动画
            animate(this, {
                width: 420,
                left: 10,
                top: 100
            }, 2000, 'Circ.easeIn', function () {
                console.log('动画执行完了');
            });
        })
    </script>
</body>
</html>